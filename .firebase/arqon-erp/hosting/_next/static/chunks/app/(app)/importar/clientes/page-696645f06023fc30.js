(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1852],{1074:(e,n,a)=>{Promise.resolve().then(a.bind(a,5745))},5745:(e,n,a)=>{"use strict";a.r(n),a.d(n,{default:()=>i});var t=a(5155),l=a(2115);function i(){let[e,n]=(0,l.useState)([]),[i,r]=(0,l.useState)([]),[s,o]=(0,l.useState)(null),[c,d]=(0,l.useState)(!1);async function u(e){var t;o(null);let l=null==(t=e.target.files)?void 0:t[0];if(l)try{let e=await Promise.all([a.e(3524),a.e(8436)]).then(a.bind(a,4246)),t=await l.arrayBuffer(),i=e.read(t,{type:"array"}),s=i.Sheets[i.SheetNames[0]],o=e.utils.sheet_to_json(s,{defval:""});n(o);let c=Object.keys(o[0]||{}),d=e=>c.find(n=>e.includes((null!=n?n:"").toString().trim().toLowerCase())),u=d(["doc","documento","dni","cuit","cuil"]),p=d(["nombre","razon social","raz\xf3n social","razon","raz\xf3n","cliente"]),m=d(["fantasia","fantas\xeda","comercial","nombre fantasia","nombre de fantasia"]),x=d(["email","mail","correo","correo electronico","correo electr\xf3nico"]),h=d(["telefono","tel\xe9fono","cel","celular","movil","m\xf3vil"]),g=d(["direccion","direcci\xf3n","domicilio","calle"]),v=d(["localidad","ciudad","poblacion","poblaci\xf3n"]),f=d(["provincia","estado","region","regi\xf3n"]),b=d(["condiva","iva","condicion iva","condici\xf3n iva","condici\xf3n de iva","cond. iva"]),j=d(["bonif","bonificacion","bonificaci\xf3n","bonif%","bonif_pct","descuento"]),N=d(["notas","observaciones","obs"]),y=d(["activo","estado","habilitado"]),C=o.map(e=>{var n,a,t,l,i,r,s,o,c,d;return{doc:u?String(null!=(n=e[u])?n:"").trim():void 0,nombre:p?String(null!=(a=e[p])?a:""):"",fantasia:m?String(null!=(t=e[m])?t:""):"",email:x?String(null!=(l=e[x])?l:""):"",telefono:h?String(null!=(i=e[h])?i:""):"",direccion:g?String(null!=(r=e[g])?r:""):"",localidad:v?String(null!=(s=e[v])?s:""):"",provincia:f?String(null!=(o=e[f])?o:""):"",condIva:b?function(e){let n=(null!=e?e:"").toString().trim().toLowerCase();if(n){if(["ri","responsable inscripto","responsable-inscripto","resp inscripto"].includes(n))return"RI";if(["monotributo","monotributista","mono"].includes(n))return"Monotributo";if(["cf","consumidor final","consumidor-final","final"].includes(n))return"CF";if(["exento","ex"].includes(n))return"Exento";if(["no responsable","no-responsable","noresp"].includes(n))return"No Responsable"}}(e[b]):void 0,bonifPct:j?Number(null!=(c=e[j])?c:0):void 0,notas:N?String(null!=(d=e[N])?d:""):"",activo:!y||function(e){let n=(null!=e?e:"").toString().trim().toLowerCase();return!!["true","1","si","s\xed","activo","activa"].includes(n)||!["false","0","no","inactivo","inactiva"].includes(n)&&void 0}(e[y])}}).filter(e=>e.nombre);r(C)}catch(e){console.error(e),o((null==e?void 0:e.message)||"No se pudo leer el archivo")}}function p(e,n,a){let t=[...i];"bonifPct"===n?t[e][n]=Number(a):"activo"===n?t[e][n]="true"===a:t[e][n]=a,r(t)}let m=(0,l.useMemo)(()=>i.length,[i]);async function x(){if(o(null),!i.length)return o("No hay filas para importar");d(!0);try{let e=0,n=0,a=0;for(let t=0;t<i.length;t+=300){let l=i.slice(t,t+300),r=await fetch("/api/import/clientes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({upsert:!0,items:l})}),s=await r.json();if(!s.ok)throw Error(s.error||"Error importando");e+=s.inserted||0,n+=s.updated||0,a+=s.total||l.length}o("âœ… Importaci\xf3n OK \xb7 Insertados: ".concat(e," \xb7 Actualizados: ").concat(n," \xb7 Total: ").concat(a))}catch(e){o("âŒ ".concat(e.message||"Error importando"))}finally{d(!1)}}return(0,t.jsxs)("main",{className:"space-y-6",children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold",children:"Importar clientes"}),(0,t.jsxs)("p",{className:"text-sm text-neutral-300",children:["Upsert por ",(0,t.jsx)("b",{children:"Doc"})," (CUIT/CUIL/DNI) o ",(0,t.jsx)("b",{children:"Email"}),". La bonificaci\xf3n se aplica en la venta (no aqu\xed)."]}),(0,t.jsxs)("div",{className:"rounded-lg border border-neutral-800 bg-neutral-900 p-4 space-y-3",children:[(0,t.jsx)("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:u,className:"block w-full"}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{onClick:x,disabled:!i.length||c,className:"rounded-md bg-emerald-600 px-4 py-2 font-medium disabled:opacity-50",children:c?"Importando...":"Importar (".concat(m," filas)")}),s&&(0,t.jsx)("span",{className:"text-sm text-neutral-300",children:s})]})]}),!!i.length&&(0,t.jsx)("div",{className:"rounded-lg border border-neutral-800 overflow-auto",children:(0,t.jsxs)("table",{className:"w-full text-sm",children:[(0,t.jsx)("thead",{className:"bg-neutral-900/60",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"p-2 text-left",children:"Doc"}),(0,t.jsx)("th",{className:"p-2 text-left",children:"Nombre"}),(0,t.jsx)("th",{className:"p-2 text-left",children:"Fantas\xeda"}),(0,t.jsx)("th",{className:"p-2 text-left",children:"Email"}),(0,t.jsx)("th",{className:"p-2 text-left",children:"Tel\xe9fono"}),(0,t.jsx)("th",{className:"p-2 text-left",children:"Direcci\xf3n"}),(0,t.jsx)("th",{className:"p-2 text-left",children:"Localidad"}),(0,t.jsx)("th",{className:"p-2 text-left",children:"Provincia"}),(0,t.jsx)("th",{className:"p-2 text-left",children:"Cond. IVA"}),(0,t.jsx)("th",{className:"p-2 text-right",children:"Bonif %"}),(0,t.jsx)("th",{className:"p-2 text-left",children:"Notas"}),(0,t.jsx)("th",{className:"p-2 text-left",children:"Activo"})]})}),(0,t.jsx)("tbody",{children:i.map((e,n)=>{var a,l;return(0,t.jsxs)("tr",{className:"border-t border-neutral-800",children:[(0,t.jsx)("td",{className:"p-2",children:(0,t.jsx)("input",{className:"w-36 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:e.doc||"",onChange:e=>p(n,"doc",e.target.value)})}),(0,t.jsx)("td",{className:"p-2",children:(0,t.jsx)("input",{className:"w-56 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:e.nombre,onChange:e=>p(n,"nombre",e.target.value)})}),(0,t.jsx)("td",{className:"p-2",children:(0,t.jsx)("input",{className:"w-48 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:e.fantasia||"",onChange:e=>p(n,"fantasia",e.target.value)})}),(0,t.jsx)("td",{className:"p-2",children:(0,t.jsx)("input",{className:"w-52 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:e.email||"",onChange:e=>p(n,"email",e.target.value)})}),(0,t.jsx)("td",{className:"p-2",children:(0,t.jsx)("input",{className:"w-40 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:e.telefono||"",onChange:e=>p(n,"telefono",e.target.value)})}),(0,t.jsx)("td",{className:"p-2",children:(0,t.jsx)("input",{className:"w-56 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:e.direccion||"",onChange:e=>p(n,"direccion",e.target.value)})}),(0,t.jsx)("td",{className:"p-2",children:(0,t.jsx)("input",{className:"w-40 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:e.localidad||"",onChange:e=>p(n,"localidad",e.target.value)})}),(0,t.jsx)("td",{className:"p-2",children:(0,t.jsx)("input",{className:"w-40 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:e.provincia||"",onChange:e=>p(n,"provincia",e.target.value)})}),(0,t.jsx)("td",{className:"p-2",children:(0,t.jsxs)("select",{className:"w-40 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:e.condIva||"",onChange:e=>p(n,"condIva",e.target.value),children:[(0,t.jsx)("option",{value:"",children:"â€”"}),(0,t.jsx)("option",{value:"RI",children:"RI"}),(0,t.jsx)("option",{value:"Monotributo",children:"Monotributo"}),(0,t.jsx)("option",{value:"CF",children:"CF"}),(0,t.jsx)("option",{value:"Exento",children:"Exento"}),(0,t.jsx)("option",{value:"No Responsable",children:"No Responsable"})]})}),(0,t.jsx)("td",{className:"p-2 text-right",children:(0,t.jsx)("input",{type:"number",step:"0.01",className:"w-24 rounded-md bg-neutral-950 px-2 py-1 text-right ring-1 ring-neutral-800",value:null!=(a=e.bonifPct)?a:0,onChange:e=>p(n,"bonifPct",e.target.value)})}),(0,t.jsx)("td",{className:"p-2",children:(0,t.jsx)("input",{className:"w-56 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:e.notas||"",onChange:e=>p(n,"notas",e.target.value)})}),(0,t.jsx)("td",{className:"p-2",children:(0,t.jsxs)("select",{className:"rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:String(null==(l=e.activo)||l),onChange:e=>p(n,"activo",e.target.value),children:[(0,t.jsx)("option",{value:"true",children:"Activo"}),(0,t.jsx)("option",{value:"false",children:"Inactivo"})]})})]},n)})})]})})]})}}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=1074)),_N_E=e.O()}]);
