(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7274],{3522:(e,t,a)=>{Promise.resolve().then(a.bind(a,7785))},7785:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>s});var r=a(5155),n=a(2115);function s(){let[e,t]=(0,n.useState)([]),[s,l]=(0,n.useState)([]),[i,c]=(0,n.useState)(null),[o,d]=(0,n.useState)(!1),[u,p]=(0,n.useState)(!1),[m,g]=(0,n.useState)(30),[h,x]=(0,n.useState)(!0),[N,b]=(0,n.useState)(10),[j,v]=(0,n.useState)("nearest"),[f,y]=(0,n.useState)(21);async function w(e){var r;c(null);let n=null==(r=e.target.files)?void 0:r[0];if(n)try{let e=await Promise.all([a.e(3524),a.e(8436)]).then(a.bind(a,4246)),r=await n.arrayBuffer(),s=e.read(r,{type:"array"}),i=s.Sheets[s.SheetNames[0]],c=e.utils.sheet_to_json(i,{defval:""});t(c);let o=Object.keys(c[0]||{}).map(e=>e.toString()),d=e=>o.find(t=>e.includes((null!=t?t:"").toString().trim().toLowerCase())),u=d(["sku","c\xf3digo","codigo","c\xf3digo de barras","codigo de barras","barcode"]),p=d(["nombre","descripcion","descripci\xf3n","detalle","producto"]),m=d(["costo","coste"]),g=d(["precio","precio venta","precio_venta","price"]),h=c.map(e=>{var t,a,r;let n=u?e[u]:void 0,s=p?String(null!=(t=e[p])?t:""):"",l=m?Number(null!=(a=e[m])?a:0):void 0,i=g?Number(null!=(r=e[g])?r:0):void 0;return{sku:n?String(n):void 0,nombre:s,costo:isFinite(Number(l))?Number(l):void 0,precio:isFinite(Number(i))?Number(i):void 0,iva:f,stock:0}}).filter(e=>e.nombre);l(h)}catch(e){console.error(e),c((null==e?void 0:e.message)||"No se pudo leer el archivo")}}let C=(0,n.useMemo)(()=>s.map(e=>{let t=u&&isFinite(Number(e.precio))?Number(e.precio):isFinite(Number(e.costo))?Number(e.costo):0,a=t;return u||(a=t*(1+(Number(m)||0)/100)),h&&(a=function(e,t,a){if(!t||t<=0)return e;let r=e/t;return"up"===a?Math.ceil(r)*t:"down"===a?Math.floor(r)*t:Math.round(r)*t}(a,Number(N)||10,j)),{...e,precio:Number(a.toFixed(2)),iva:Number(f)||21}}),[s,u,m,h,N,j,f]);function k(e,t,a){let r=[...s];"precio"===t||"costo"===t||"iva"===t||"stock"===t?r[e][t]=Number(a):r[e][t]=a,l(r)}async function S(){if(c(null),!C.length)return void c("No hay filas a importar");d(!0);try{let e=0,t=0,a=0;for(let r=0;r<C.length;r+=300){let n=C.slice(r,r+300),s=await fetch("/api/import/productos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({upsert:!0,items:n})}),l=await s.json();if(!l.ok)throw Error(l.error||"Error importando");e+=l.inserted||0,t+=l.updated||0,a+=l.total||n.length}c("âœ… Importaci\xf3n OK \xb7 Insertados: ".concat(e," \xb7 Actualizados: ").concat(t," \xb7 Total: ").concat(a))}catch(e){c("âŒ ".concat(e.message||"Error importando"))}finally{d(!1)}}return(0,r.jsxs)("main",{className:"space-y-6",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold",children:"Importar precios"}),(0,r.jsxs)("div",{className:"rounded-lg border border-neutral-800 bg-neutral-900 p-4 space-y-3",children:[(0,r.jsx)("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:w,className:"block w-full"}),(0,r.jsxs)("div",{className:"grid sm:grid-cols-2 lg:grid-cols-3 gap-3",children:[(0,r.jsxs)("label",{className:"flex items-center gap-2",children:[(0,r.jsx)("input",{type:"checkbox",checked:u,onChange:e=>p(e.target.checked)}),"Usar precio del archivo (sin markup)"]}),!u&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"Markup %"}),(0,r.jsx)("input",{type:"number",value:m,onChange:e=>g(Number(e.target.value)),className:"w-24 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"Redondear"}),(0,r.jsxs)("select",{value:h?"si":"no",onChange:e=>x("si"===e.target.value),className:"rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",children:[(0,r.jsx)("option",{value:"si",children:"S\xed"}),(0,r.jsx)("option",{value:"no",children:"No"})]})]}),h&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"M\xfaltiplo"}),(0,r.jsx)("input",{type:"number",value:N,onChange:e=>b(Number(e.target.value)),className:"w-24 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"M\xe9todo"}),(0,r.jsxs)("select",{value:j,onChange:e=>v(e.target.value),className:"rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",children:[(0,r.jsx)("option",{value:"nearest",children:"Al m\xe1s cercano"}),(0,r.jsx)("option",{value:"up",children:"Hacia arriba"}),(0,r.jsx)("option",{value:"down",children:"Hacia abajo"})]})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("span",{children:"IVA %"}),(0,r.jsx)("input",{type:"number",value:f,onChange:e=>y(Number(e.target.value)),className:"w-24 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800"})]})]}),(0,r.jsxs)("div",{className:"flex gap-3",children:[(0,r.jsx)("button",{onClick:S,disabled:!s.length||o,className:"rounded-md bg-emerald-600 px-4 py-2 font-medium disabled:opacity-50",children:o?"Importando...":"Importar (upsert por SKU)"}),i&&(0,r.jsx)("p",{className:"text-sm text-neutral-300",children:i})]})]}),!!s.length&&(0,r.jsx)("div",{className:"rounded-lg border border-neutral-800 overflow-auto",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-neutral-900/60",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-left p-2",children:"SKU"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Nombre"}),(0,r.jsx)("th",{className:"text-right p-2",children:"Costo"}),(0,r.jsx)("th",{className:"text-right p-2",children:"Precio"}),(0,r.jsx)("th",{className:"text-right p-2",children:"IVA %"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Unidad"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Categor\xeda"}),(0,r.jsx)("th",{className:"text-right p-2",children:"Stock"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Notas"})]})}),(0,r.jsx)("tbody",{children:C.map((e,t)=>{var a,n,l,i,c,o,d;return(0,r.jsxs)("tr",{className:"border-t border-neutral-800",children:[(0,r.jsx)("td",{className:"p-2",children:(0,r.jsx)("input",{className:"w-32 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:s[t].sku||"",onChange:e=>k(t,"sku",e.target.value)})}),(0,r.jsx)("td",{className:"p-2",children:(0,r.jsx)("input",{className:"w-64 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:s[t].nombre,onChange:e=>k(t,"nombre",e.target.value)})}),(0,r.jsx)("td",{className:"p-2 text-right",children:(0,r.jsx)("input",{type:"number",step:"0.01",className:"w-28 rounded-md bg-neutral-950 px-2 py-1 text-right ring-1 ring-neutral-800",value:null!=(a=s[t].costo)?a:"",onChange:e=>k(t,"costo",e.target.value)})}),(0,r.jsx)("td",{className:"p-2 text-right",children:(0,r.jsx)("input",{type:"number",step:"0.01",className:"w-28 rounded-md bg-neutral-950 px-2 py-1 text-right ring-1 ring-neutral-800",value:null!=(n=e.precio)?n:"",onChange:e=>k(t,"precio",e.target.value)})}),(0,r.jsx)("td",{className:"p-2 text-right",children:(0,r.jsx)("input",{type:"number",className:"w-20 rounded-md bg-neutral-950 px-2 py-1 text-right ring-1 ring-neutral-800",value:null!=(l=e.iva)?l:21,onChange:e=>k(t,"iva",e.target.value)})}),(0,r.jsx)("td",{className:"p-2",children:(0,r.jsx)("input",{className:"w-28 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:null!=(i=s[t].unidad)?i:"",onChange:e=>k(t,"unidad",e.target.value)})}),(0,r.jsx)("td",{className:"p-2",children:(0,r.jsx)("input",{className:"w-36 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:null!=(c=s[t].categoria)?c:"",onChange:e=>k(t,"categoria",e.target.value)})}),(0,r.jsx)("td",{className:"p-2 text-right",children:(0,r.jsx)("input",{type:"number",className:"w-20 rounded-md bg-neutral-950 px-2 py-1 text-right ring-1 ring-neutral-800",value:null!=(o=s[t].stock)?o:0,onChange:e=>k(t,"stock",e.target.value)})}),(0,r.jsx)("td",{className:"p-2",children:(0,r.jsx)("input",{className:"w-60 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:null!=(d=s[t].notas)?d:"",onChange:e=>k(t,"notas",e.target.value)})})]},t)})})]})})]})}}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=3522)),_N_E=e.O()}]);
