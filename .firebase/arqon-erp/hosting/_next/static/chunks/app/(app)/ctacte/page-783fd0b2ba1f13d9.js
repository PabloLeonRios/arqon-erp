(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4608],{3:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>l});var r=t(5155),n=t(2115);function l(){let[e,a]=(0,n.useState)(""),[t,l]=(0,n.useState)(""),[s,c]=(0,n.useState)([]),[d,i]=(0,n.useState)(0),[o,u]=(0,n.useState)(null),[m,p]=(0,n.useState)(0),[h,x]=(0,n.useState)("efectivo"),[g,j]=(0,n.useState)(""),[N,b]=(0,n.useState)("");async function f(){if(u(null),!e)return void u("Ingres\xe1 un Cliente ID (por ahora simple)");try{let n=await fetch("/api/ctacte?clienteId=".concat(encodeURIComponent(e),"&limit=200"),{cache:"no-store"}),s=await n.json();if(s.ok){if(c(s.data||[]),i(s.saldo||0),!t){var a,r;let e=(null==(r=s.data)||null==(a=r[0])?void 0:a.clienteNombre)||"";l(e)}}else u(s.error||"Error consultando cta cte")}catch(e){u(e.message||"Error de red")}}async function v(a){if(a.preventDefault(),u(null),!e||!t||!m)return void u("Complet\xe1 cliente, nombre y monto");try{let a=await fetch("/api/ctacte/pagos",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({clienteId:e,clienteNombre:t,monto:m,medio:h,descripcion:g||"Pago en cuenta corriente",facturaId:N||void 0})}),r=await a.json();r.ok?(p(0),j(""),b(""),await f(),u("âœ… Pago registrado (Recibo ".concat(r.reciboId,")"))):u(r.error||"No se pudo registrar el pago")}catch(e){u(e.message||"Error de red")}}let y=(0,n.useMemo)(()=>"Saldo actual: $".concat(d.toFixed(2)),[d]);return(0,r.jsxs)("main",{className:"space-y-6",children:[(0,r.jsx)("div",{className:"flex items-end justify-between",children:(0,r.jsxs)("div",{children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold",children:"Cuenta Corriente"}),(0,r.jsx)("p",{className:"text-neutral-400 text-sm",children:y})]})}),(0,r.jsxs)("div",{className:"rounded-lg border border-neutral-800 bg-neutral-900 p-4 grid sm:grid-cols-3 gap-3",children:[(0,r.jsx)("input",{value:e,onChange:e=>a(e.target.value),placeholder:"Cliente ID (ej: CLI002)",className:"rounded-md bg-neutral-950 px-3 py-2 ring-1 ring-neutral-800"}),(0,r.jsx)("input",{value:t,onChange:e=>l(e.target.value),placeholder:"Cliente Nombre (solo visual)",className:"rounded-md bg-neutral-950 px-3 py-2 ring-1 ring-neutral-800"}),(0,r.jsx)("button",{onClick:f,className:"rounded-md bg-emerald-600 px-4 py-2 font-medium",children:"Buscar"})]}),(0,r.jsxs)("form",{onSubmit:v,className:"rounded-lg border border-neutral-800 bg-neutral-900 p-4 grid sm:grid-cols-5 gap-3",children:[(0,r.jsx)("input",{value:m||"",onChange:e=>p(Number(e.target.value)),type:"number",step:"0.01",placeholder:"Monto",className:"rounded-md bg-neutral-950 px-3 py-2 ring-1 ring-neutral-800"}),(0,r.jsx)("input",{value:h,onChange:e=>x(e.target.value),placeholder:"Medio",className:"rounded-md bg-neutral-950 px-3 py-2 ring-1 ring-neutral-800"}),(0,r.jsx)("input",{value:g,onChange:e=>j(e.target.value),placeholder:"Descripci\xf3n (opcional)",className:"rounded-md bg-neutral-950 px-3 py-2 ring-1 ring-neutral-800"}),(0,r.jsx)("input",{value:N,onChange:e=>b(e.target.value),placeholder:"Factura ID (opcional)",className:"rounded-md bg-neutral-950 px-3 py-2 ring-1 ring-neutral-800"}),(0,r.jsx)("button",{className:"rounded-md bg-emerald-600 px-4 py-2 font-medium",children:"Registrar pago"})]}),o&&(0,r.jsx)("p",{className:"text-sm text-neutral-300",children:o}),(0,r.jsx)("div",{className:"rounded-lg border border-neutral-800 overflow-hidden",children:(0,r.jsxs)("table",{className:"w-full text-sm",children:[(0,r.jsx)("thead",{className:"bg-neutral-900/60",children:(0,r.jsxs)("tr",{children:[(0,r.jsx)("th",{className:"text-left p-2",children:"Fecha"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Mov."}),(0,r.jsx)("th",{className:"text-right p-2",children:"Monto"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Factura"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Recibo"}),(0,r.jsx)("th",{className:"text-left p-2",children:"Descripci\xf3n"})]})}),(0,r.jsxs)("tbody",{children:[s.map(e=>{var a;return(0,r.jsxs)("tr",{className:"border-t border-neutral-800",children:[(0,r.jsx)("td",{className:"p-2",children:(null==(a=e.fecha)?void 0:a.seconds)?new Date(1e3*e.fecha.seconds).toLocaleString():"-"}),(0,r.jsx)("td",{className:"p-2",children:e.movimiento}),(0,r.jsxs)("td",{className:"p-2 text-right",children:["$",Number(e.monto||0).toFixed(2)]}),(0,r.jsx)("td",{className:"p-2",children:e.facturaId||""}),(0,r.jsx)("td",{className:"p-2",children:e.reciboId||""}),(0,r.jsx)("td",{className:"p-2",children:e.descripcion||""})]},e.id)}),0===s.length&&(0,r.jsx)("tr",{children:(0,r.jsx)("td",{className:"p-3 text-neutral-500",colSpan:6,children:"Sin movimientos para este cliente."})})]})]})})]})}},4673:(e,a,t)=>{Promise.resolve().then(t.bind(t,3))}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=4673)),_N_E=e.O()}]);