(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1347],{1847:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var i=r(2115);let a=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},n=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var s={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,i.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:l=2,absoluteStrokeWidth:c,className:o="",children:d,iconNode:h,...u}=e;return(0,i.createElement)("svg",{ref:t,...s,width:a,height:a,stroke:r,strokeWidth:c?24*Number(l)/Number(a):l,className:n("lucide",o),...!d&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(u)&&{"aria-hidden":"true"},...u},[...h.map(e=>{let[t,r]=e;return(0,i.createElement)(t,r)}),...Array.isArray(d)?d:[d]])}),c=(e,t)=>{let r=(0,i.forwardRef)((r,s)=>{let{className:c,...o}=r;return(0,i.createElement)(l,{ref:s,iconNode:t,className:n("lucide-".concat(a(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),c),...o})});return r.displayName=a(e),r}},3498:(e,t,r)=>{Promise.resolve().then(r.bind(r,9348))},4927:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var i=r(5155);function a(e){let{title:t,subtitle:r,actions:a}=e;return(0,i.jsx)("header",{className:"topbar",children:(0,i.jsxs)("div",{className:"topbar-inner",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-xl font-semibold",children:t}),r&&(0,i.jsx)("p",{className:"text-sm text-muted",children:r})]}),(0,i.jsx)("div",{className:"flex items-center gap-2",children:a})]})})}r(2115)},5728:(e,t,r)=>{"use strict";r.d(t,{j:()=>l,db:()=>c});var i=r(2078),a=r(2553),n=r(9708);let s=(0,i.Dk)().length?(0,i.Sx)():(0,i.Wp)({apiKey:"AIzaSyBn_tEKXbH1MODTU-ZX6wI7H6gcrIib0RM",authDomain:"arqon-erp.firebaseapp.com",projectId:"arqon-erp",storageBucket:"arqon-erp.appspot.com",messagingSenderId:"100563303537",appId:"1:100563303537:web:361ed1c0989e4868c16fd0"}),l=(0,a.xI)(s),c=(0,n.aU)(s)},9348:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>u});var i=r(5155),a=r(2115),n=r(5728),s=r(9708),l=r(4927);let c=(0,r(1847).A)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);function o(e){if(null==e)return NaN;let t=String(e).trim();if(!t)return NaN;let r=(t=t.replace(/\s+/g,"").replace(/[^\d.,-]/g,"")).includes("."),i=t.includes(",");if(r&&i){let e=t.lastIndexOf(".");if(t.lastIndexOf(",")>e)t=t.replace(/\./g,"").replace(/,/g,".");else{let e=(t=t.replace(/,/g,"")).lastIndexOf(".");t=t.slice(0,e).replace(/\./g,"")+"."+t.slice(e+1)}}else if(i){let e=t.split(",");t=2===e.length&&e[1].length<=3?e[0].replace(/\./g,"")+"."+e[1]:t.replace(/,/g,"")}else if(r){let e=t.lastIndexOf(".");t=t.slice(0,e).replace(/\./g,"")+"."+t.slice(e+1)}let a=Number(t=t.replace(/[^0-9.-]/g,""));return isNaN(a)?NaN:a}function d(e){return e?e.split("+").map(e=>o(e)).filter(e=>isFinite(e)&&e>0):[]}function h(e){return null!=e&&isFinite(Number(e))?"$".concat(Number(e).toFixed(2)):"—"}function u(){let[e,t]=(0,a.useState)(""),[r,u]=(0,a.useState)([]),[p,x]=(0,a.useState)({});(0,a.useEffect)(()=>{let e=(0,s.P)((0,s.rJ)(n.db,"productos"),(0,s.My)("updatedAt","desc"),(0,s.AB)(300)),t=(0,s.aQ)(e,e=>{u(e.docs.map(e=>{let t=e.data(),r=t.bonifChain||(t.bonifs&&t.bonifs.length?t.bonifs.join("+"):"");return{id:e.id,bonifChain:r,...t}}))});return()=>t()},[]);let m=(0,a.useMemo)(()=>{let t=e.trim().toLowerCase();return t?r.filter(e=>(e.descripcion||"").toLowerCase().includes(t)||(e.codigo||"").toLowerCase().includes(t)||(e.categoria||"").toLowerCase().includes(t)):r},[r,e]);function g(e){var t,r;let i=o(e.precio_base),a=d(e.bonifChain||""),n=o(e.markup)||0;if(!isFinite(i)||i<=0)return{costo_neto:null,precio:null};let s=a.reduce((e,t)=>e*(1-t/100),i),l=(t=s*(1+n/100),r=e.roundMode||"nearest10",isFinite(t)?"nearest10"===r?10*Math.round(t/10):"ceil10"===r?10*Math.ceil(t/10):"floor10"===r?10*Math.floor(t/10):t:t);return{costo_neto:Math.round(100*s)/100,precio:Math.round(100*l)/100}}async function f(e){var t,r;let i=p[e];if(!i)return;let a=g(i);await (0,s.mZ)((0,s.H9)(n.db,"productos",e),{precio_base:isFinite(o(i.precio_base))?o(i.precio_base):null,bonifs:d(i.bonifChain||""),bonifChain:i.bonifChain||null,markup:isFinite(o(i.markup))?o(i.markup):0,roundMode:i.roundMode||"nearest10",costo_neto:null!=(t=a.costo_neto)?t:null,precio:null!=(r=a.precio)?r:null,updatedAt:(0,s.O5)()}),x(t=>{let r={...t};return delete r[e],r})}return(0,i.jsxs)("main",{children:[(0,i.jsx)(l.A,{title:"Precios",subtitle:"Editar manualmente precio, bonificaci\xf3n, markup y redondeo",actions:(0,i.jsx)("a",{href:"/importar/precios",className:"btn-outline",children:"↗ Importar precios"})}),(0,i.jsxs)("div",{className:"container mt-6",children:[(0,i.jsx)("div",{className:"card p-4 mb-4",children:(0,i.jsx)("input",{className:"border rounded-lg p-2 w-full",placeholder:"Buscar por descripci\xf3n, c\xf3digo o categor\xeda…",value:e,onChange:e=>t(e.target.value)})}),(0,i.jsx)("div",{className:"card p-4 overflow-x-auto",children:(0,i.jsxs)("table",{className:"table table-striped table-hover",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{children:"Descripci\xf3n"}),(0,i.jsx)("th",{children:"C\xf3digo"}),(0,i.jsx)("th",{children:"Categor\xeda"}),(0,i.jsx)("th",{className:"text-right",children:"Precio fuente"}),(0,i.jsx)("th",{className:"text-right",children:"Bonif"}),(0,i.jsx)("th",{className:"text-right",children:"Costo neto"}),(0,i.jsx)("th",{className:"text-right",children:"Markup"}),(0,i.jsx)("th",{className:"text-right",children:"Precio final"}),(0,i.jsx)("th",{children:"Redondeo"}),(0,i.jsx)("th",{style:{width:140},children:"Acciones"})]})}),(0,i.jsxs)("tbody",{children:[m.map(e=>{let t=p[e.id];if(!t)return(0,i.jsxs)("tr",{children:[(0,i.jsx)("td",{children:e.descripcion}),(0,i.jsx)("td",{children:e.codigo||"—"}),(0,i.jsx)("td",{children:e.categoria||"—"}),(0,i.jsx)("td",{className:"text-right",children:h(e.precio_base)}),(0,i.jsx)("td",{className:"text-right",children:e.bonifChain?"".concat(e.bonifChain,"%"):e.bonifs&&e.bonifs.length?e.bonifs.join("+")+"%":"—"}),(0,i.jsx)("td",{className:"text-right",children:h(e.costo_neto)}),(0,i.jsx)("td",{className:"text-right",children:"number"==typeof e.markup?"".concat(e.markup.toFixed(2),"%"):"—"}),(0,i.jsx)("td",{className:"text-right",children:h(e.precio)}),(0,i.jsx)("td",{children:e.roundMode||"—"}),(0,i.jsx)("td",{className:"flex gap-2",children:(0,i.jsx)("button",{className:"btn-outline",onClick:()=>{x(t=>{var r,i,a;return{...t,[e.id]:{precio_base:null!=(r=e.precio_base)?r:0,bonifChain:e.bonifChain||"",markup:null!=(i=e.markup)?i:0,roundMode:null!=(a=e.roundMode)?a:"nearest10"}}})},children:"Editar"})})]},e.id);let r=g(t);return(0,i.jsxs)("tr",{className:"bg-amber-50",children:[(0,i.jsx)("td",{children:e.descripcion}),(0,i.jsx)("td",{children:e.codigo||"—"}),(0,i.jsx)("td",{children:e.categoria||"—"}),(0,i.jsx)("td",{className:"text-right",children:(0,i.jsx)("input",{className:"border rounded-lg p-1 w-28 text-right",value:t.precio_base,onChange:t=>x(r=>({...r,[e.id]:{...r[e.id],precio_base:t.target.value}}))})}),(0,i.jsx)("td",{className:"text-right",children:(0,i.jsx)("input",{className:"border rounded-lg p-1 w-24 text-right",value:t.bonifChain,placeholder:"20+10",onChange:t=>x(r=>({...r,[e.id]:{...r[e.id],bonifChain:t.target.value}}))})}),(0,i.jsx)("td",{className:"text-right",children:h(r.costo_neto)}),(0,i.jsx)("td",{className:"text-right",children:(0,i.jsx)("input",{className:"border rounded-lg p-1 w-20 text-right",value:t.markup,onChange:t=>x(r=>({...r,[e.id]:{...r[e.id],markup:t.target.value}}))})}),(0,i.jsx)("td",{className:"text-right",children:(0,i.jsx)("b",{children:h(r.precio)})}),(0,i.jsx)("td",{children:(0,i.jsxs)("select",{className:"border rounded-lg p-1",value:t.roundMode,onChange:t=>x(r=>({...r,[e.id]:{...r[e.id],roundMode:t.target.value}})),children:[(0,i.jsx)("option",{value:"none",children:"none"}),(0,i.jsx)("option",{value:"nearest10",children:"nearest10"}),(0,i.jsx)("option",{value:"ceil10",children:"ceil10"}),(0,i.jsx)("option",{value:"floor10",children:"floor10"})]})}),(0,i.jsxs)("td",{className:"flex gap-2",children:[(0,i.jsxs)("button",{className:"btn-primary",onClick:()=>f(e.id),children:[(0,i.jsx)(c,{size:16})," Guardar"]}),(0,i.jsx)("button",{className:"btn-outline",onClick:()=>x(t=>{let r={...t};return delete r[e.id],r}),children:"Cancelar"})]})]},e.id)}),0===m.length&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:10,children:(0,i.jsxs)("div",{className:"empty",children:[(0,i.jsx)("h3",{children:"Sin resultados"}),(0,i.jsx)("p",{children:"Busc\xe1 por descripci\xf3n, c\xf3digo o categor\xeda."})]})})})]})]})})]})]})}}},e=>{e.O(0,[9135,3965,7240,8441,1255,7358],()=>e(e.s=3498)),_N_E=e.O()}]);