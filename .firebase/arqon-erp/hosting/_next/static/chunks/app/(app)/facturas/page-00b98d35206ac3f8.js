(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6873],{4951:(e,t,a)=>{Promise.resolve().then(a.bind(a,8002))},5728:(e,t,a)=>{"use strict";a.d(t,{j:()=>d,db:()=>i});var s=a(2078),r=a(2553),c=a(9708);let l=(0,s.Dk)().length?(0,s.Sx)():(0,s.Wp)({apiKey:"AIzaSyBn_tEKXbH1MODTU-ZX6wI7H6gcrIib0RM",authDomain:"arqon-erp.firebaseapp.com",projectId:"arqon-erp",storageBucket:"arqon-erp.appspot.com",messagingSenderId:"100563303537",appId:"1:100563303537:web:361ed1c0989e4868c16fd0"}),d=(0,r.xI)(l),i=(0,c.aU)(l)},8002:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>d});var s=a(5155),r=a(2115),c=a(5728),l=a(9708);function d(){let[e,t]=(0,r.useState)([]),[a,d]=(0,r.useState)(""),[n,o]=(0,r.useState)([{desc:"",qty:1,price:0}]),[u,m]=(0,r.useState)("contado"),[p,h]=(0,r.useState)(null),[x,b]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=(0,l.P)((0,l.rJ)(c.db,"clientes"),(0,l.My)("nombre","asc")),a=(0,l.aQ)(e,e=>{t(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>a()},[]);let g=(0,r.useMemo)(()=>n.reduce((e,t)=>e+(Number(t.qty)||0)*(Number(t.price)||0),0),[n]);function j(e,t,a){let s=[...n];"qty"===t||"price"===t?s[e][t]=Number(a):s[e][t]=a,o(s)}async function f(t){if(t.preventDefault(),!a)return void h("❌ Eleg\xed un cliente");if(g<=0)return void h("❌ El total debe ser mayor a 0");b(!0),h(null);try{var s,r,d;let t=e.find(e=>e.id===a),i=await (0,l.gS)((0,l.rJ)(c.db,"facturas"),{tipo:"FI",fecha:(0,l.O5)(),clienteId:a,clienteNombre:null!=(s=null==t?void 0:t.nombre)?s:"",items:n,total:g,formaPago:u,estado:"cerrada"});"contado"===u&&await (0,l.gS)((0,l.rJ)(c.db,"caja"),{fecha:(0,l.O5)(),tipo:"ingreso",origen:"factura",facturaId:i.id,descripcion:"Cobro FI ".concat(i.id," - ").concat(null!=(r=null==t?void 0:t.nombre)?r:""),monto:g,medio:"efectivo"}),"cta_cte"===u&&await (0,l.gS)((0,l.rJ)(c.db,"ctacte"),{fecha:(0,l.O5)(),clienteId:a,clienteNombre:null!=(d=null==t?void 0:t.nombre)?d:"",facturaId:i.id,movimiento:"debe",monto:g,saldo:g,descripcion:"FI a cr\xe9dito ".concat(i.id)}),h("✅ Factura guardada correctamente"),o([{desc:"",qty:1,price:0}]),m("contado")}catch(e){h("❌ ".concat(e.message))}finally{b(!1)}}return(0,s.jsx)("main",{className:"min-h-screen p-6 bg-gray-50",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto space-y-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:"Facturaci\xf3n"}),(0,s.jsxs)("form",{onSubmit:f,className:"bg-white p-4 rounded-xl shadow space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,s.jsxs)("select",{className:"border rounded-lg p-3",value:a,onChange:e=>d(e.target.value),required:!0,children:[(0,s.jsx)("option",{value:"",children:"— Seleccionar cliente —"}),e.map(e=>(0,s.jsx)("option",{value:e.id,children:e.nombre},e.id))]}),(0,s.jsxs)("select",{className:"border rounded-lg p-3",value:u,onChange:e=>m(e.target.value),children:[(0,s.jsx)("option",{value:"contado",children:"Contado (impacta en Caja)"}),(0,s.jsx)("option",{value:"cta_cte",children:"Cuenta corriente"})]})]}),(0,s.jsxs)("div",{className:"border rounded-xl overflow-hidden",children:[(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-100",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-left p-2",children:"Descripci\xf3n"}),(0,s.jsx)("th",{className:"text-right p-2 w-24",children:"Cant."}),(0,s.jsx)("th",{className:"text-right p-2 w-32",children:"Precio"}),(0,s.jsx)("th",{className:"text-right p-2 w-32",children:"Importe"}),(0,s.jsx)("th",{className:"p-2 w-16"})]})}),(0,s.jsx)("tbody",{children:n.map((e,t)=>(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"p-2",children:(0,s.jsx)("input",{className:"w-full border rounded-lg p-2",placeholder:"Servicio o producto",value:e.desc,onChange:e=>j(t,"desc",e.target.value),required:!0})}),(0,s.jsx)("td",{className:"p-2 text-right",children:(0,s.jsx)("input",{type:"number",min:0,className:"w-full border rounded-lg p-2 text-right",value:e.qty,onChange:e=>j(t,"qty",e.target.value),required:!0})}),(0,s.jsx)("td",{className:"p-2 text-right",children:(0,s.jsx)("input",{type:"number",step:"0.01",min:0,className:"w-full border rounded-lg p-2 text-right",value:e.price,onChange:e=>j(t,"price",e.target.value),required:!0})}),(0,s.jsx)("td",{className:"p-2 text-right",children:(Number(e.qty)*Number(e.price)).toFixed(2)}),(0,s.jsx)("td",{className:"p-2 text-center",children:(0,s.jsx)("button",{type:"button",className:"text-red-600",onClick:()=>(function(e){let t=[...n];t.splice(e,1),o(t.length?t:[{desc:"",qty:1,price:0}])})(t),children:"✕"})})]},t))})]}),(0,s.jsx)("div",{className:"p-2",children:(0,s.jsx)("button",{type:"button",className:"rounded-lg border px-3 py-2",onClick:function(){o([...n,{desc:"",qty:1,price:0}])},children:"+ Agregar l\xednea"})})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"text-lg",children:[(0,s.jsx)("b",{children:"Total:"})," $",g.toFixed(2)]}),(0,s.jsx)("button",{type:"submit",disabled:x,className:"rounded-lg bg-black text-white py-2 px-4 disabled:opacity-60",children:x?"Guardando…":"Guardar factura"})]}),p&&(0,s.jsx)("p",{className:"text-sm text-gray-700",children:p})]}),(0,s.jsx)(i,{})]})})}function i(){let[e,t]=(0,r.useState)([]);return(0,r.useEffect)(()=>{let e=(0,l.P)((0,l.rJ)(c.db,"facturas"),(0,l.My)("fecha","desc")),a=(0,l.aQ)(e,e=>{t(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>a()},[]),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-xl shadow",children:[(0,s.jsx)("h2",{className:"text-lg font-medium mb-2",children:"\xdaltimas facturas"}),(0,s.jsxs)("ul",{className:"divide-y",children:[e.slice(0,5).map(e=>(0,s.jsxs)("li",{className:"py-2 text-sm flex justify-between",children:[(0,s.jsxs)("span",{children:[e.clienteNombre," — ","contado"===e.formaPago?"Contado":"Cta Cte"]}),(0,s.jsxs)("b",{children:["$",Number(e.total).toFixed(2)]})]},e.id)),0===e.length&&(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Sin facturas todav\xeda."})]})]})}}},e=>{e.O(0,[9135,3965,7240,8441,1255,7358],()=>e(e.s=4951)),_N_E=e.O()}]);