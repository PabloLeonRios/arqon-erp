(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3704],{1847:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var a=r(2115);let s=e=>{let t=e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase());return t.charAt(0).toUpperCase()+t.slice(1)},i=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=(0,a.forwardRef)((e,t)=>{let{color:r="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:n,className:d="",children:o,iconNode:u,...m}=e;return(0,a.createElement)("svg",{ref:t,...c,width:s,height:s,stroke:r,strokeWidth:n?24*Number(l)/Number(s):l,className:i("lucide",d),...!o&&!(e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(m)&&{"aria-hidden":"true"},...m},[...u.map(e=>{let[t,r]=e;return(0,a.createElement)(t,r)}),...Array.isArray(o)?o:[o]])}),n=(e,t)=>{let r=(0,a.forwardRef)((r,c)=>{let{className:n,...d}=r;return(0,a.createElement)(l,{ref:c,iconNode:t,className:i("lucide-".concat(s(e).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()),"lucide-".concat(e),n),...d})});return r.displayName=s(e),r}},4741:(e,t,r)=>{Promise.resolve().then(r.bind(r,7800))},4927:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});var a=r(5155);function s(e){let{title:t,subtitle:r,actions:s}=e;return(0,a.jsx)("header",{className:"topbar",children:(0,a.jsxs)("div",{className:"topbar-inner",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl font-semibold",children:t}),r&&(0,a.jsx)("p",{className:"text-sm text-muted",children:r})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:s})]})})}r(2115)},5728:(e,t,r)=>{"use strict";r.d(t,{j:()=>l,db:()=>n});var a=r(2078),s=r(2553),i=r(9708);let c=(0,a.Dk)().length?(0,a.Sx)():(0,a.Wp)({apiKey:"AIzaSyBn_tEKXbH1MODTU-ZX6wI7H6gcrIib0RM",authDomain:"arqon-erp.firebaseapp.com",projectId:"arqon-erp",storageBucket:"arqon-erp.appspot.com",messagingSenderId:"100563303537",appId:"1:100563303537:web:361ed1c0989e4868c16fd0"}),l=(0,s.xI)(c),n=(0,i.aU)(c)},7800:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var a=r(5155),s=r(2115),i=r(5728),c=r(9708),l=r(4927);let n=(0,r(1847).A)("printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);function d(){let[e,t]=(0,s.useState)([]),[r,d]=(0,s.useState)(""),[o,u]=(0,s.useState)([{desc:"",qty:1,price:0}]),[m,h]=(0,s.useState)("borrador"),[p,x]=(0,s.useState)(null),[b,j]=(0,s.useState)([]);(0,s.useEffect)(()=>{let e=(0,c.P)((0,c.rJ)(i.db,"clientes"),(0,c.My)("nombre","asc")),r=(0,c.aQ)(e,e=>t(e.docs.map(e=>({id:e.id,...e.data()})))),a=(0,c.P)((0,c.rJ)(i.db,"presupuestos"),(0,c.My)("fecha","desc")),s=(0,c.aQ)(a,e=>j(e.docs.map(e=>({id:e.id,...e.data()}))));return()=>{r(),s()}},[]);let g=(0,s.useMemo)(()=>o.reduce((e,t)=>e+(Number(t.qty)||0)*(Number(t.price)||0),0),[o]);function N(e,t,r){let a=[...o];"qty"===t||"price"===t?a[e][t]=Number(r):a[e][t]=r,u(a)}async function f(t){if(t.preventDefault(),x(null),!r)return x("âŒ Eleg\xed un cliente");if(g<=0)return x("âŒ El total debe ser mayor a 0");let a=e.find(e=>e.id===r);try{var s;await (0,c.gS)((0,c.rJ)(i.db,"presupuestos"),{fecha:(0,c.O5)(),clienteId:r,clienteNombre:null!=(s=null==a?void 0:a.nombre)?s:"",items:o,total:g,estado:m}),u([{desc:"",qty:1,price:0}]),h("borrador"),x("âœ… Presupuesto guardado")}catch(e){x("âŒ ".concat(e.message))}}async function v(e,t){x(null);try{let r=await (0,c.gS)((0,c.rJ)(i.db,"facturas"),{tipo:"FI",fecha:(0,c.O5)(),clienteId:e.clienteId,clienteNombre:e.clienteNombre,items:e.items,total:e.total,formaPago:t,estado:"cerrada",desdePresupuesto:e.id});"contado"===t?await (0,c.gS)((0,c.rJ)(i.db,"caja"),{fecha:(0,c.O5)(),tipo:"ingreso",origen:"factura",facturaId:r.id,descripcion:"Cobro FI ".concat(r.id," - ").concat(e.clienteNombre),monto:e.total,medio:"efectivo"}):await (0,c.gS)((0,c.rJ)(i.db,"ctacte"),{fecha:(0,c.O5)(),clienteId:e.clienteId,clienteNombre:e.clienteNombre,facturaId:r.id,movimiento:"debe",monto:e.total,saldo:e.total,descripcion:"FI a cr\xe9dito ".concat(r.id)}),await (0,c.mZ)((0,c.H9)(i.db,"presupuestos",e.id),{estado:"aprobado",facturaId:r.id}),x("âœ… Convertido a factura correctamente")}catch(e){x("âŒ ".concat(e.message))}}return(0,a.jsxs)("main",{className:"min-h-screen",children:[(0,a.jsx)(l.A,{title:"Presupuestos",subtitle:"Cre\xe1, lista y convert\xed a factura",actions:(0,a.jsx)("a",{className:"btn-outline",href:"/panel",children:"â† Volver"})}),(0,a.jsxs)("form",{onSubmit:f,className:"card p-4 mb-6 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:[(0,a.jsxs)("select",{className:"border rounded-lg p-3",value:r,onChange:e=>d(e.target.value),required:!0,children:[(0,a.jsx)("option",{value:"",children:"â€” Seleccionar cliente â€”"}),e.map(e=>(0,a.jsx)("option",{value:e.id,children:e.nombre},e.id))]}),(0,a.jsxs)("select",{className:"border rounded-lg p-3",value:m,onChange:e=>h(e.target.value),children:[(0,a.jsx)("option",{value:"borrador",children:"Borrador"}),(0,a.jsx)("option",{value:"enviado",children:"Enviado"})]}),(0,a.jsx)("div",{className:"flex items-center justify-end",children:(0,a.jsxs)("div",{className:"text-lg",children:[(0,a.jsx)("b",{children:"Total:"})," $",g.toFixed(2)]})})]}),(0,a.jsxs)("div",{className:"border rounded-xl overflow-hidden",children:[(0,a.jsxs)("table",{className:"table table-striped table-hover",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Descripci\xf3n"}),(0,a.jsx)("th",{className:"text-right w-24",children:"Cant."}),(0,a.jsx)("th",{className:"text-right w-32",children:"Precio"}),(0,a.jsx)("th",{className:"text-right w-32",children:"Importe"}),(0,a.jsx)("th",{className:"w-12"})]})}),(0,a.jsx)("tbody",{children:o.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:(0,a.jsx)("input",{className:"w-full border rounded-lg p-2",placeholder:"Servicio o producto",value:e.desc,onChange:e=>N(t,"desc",e.target.value),required:!0})}),(0,a.jsx)("td",{className:"text-right",children:(0,a.jsx)("input",{type:"number",min:0,className:"w-full border rounded-lg p-2 text-right",value:e.qty,onChange:e=>N(t,"qty",e.target.value),required:!0})}),(0,a.jsx)("td",{className:"text-right",children:(0,a.jsx)("input",{type:"number",step:"0.01",min:0,className:"w-full border rounded-lg p-2 text-right",value:e.price,onChange:e=>N(t,"price",e.target.value),required:!0})}),(0,a.jsx)("td",{className:"text-right",children:(Number(e.qty)*Number(e.price)).toFixed(2)}),(0,a.jsx)("td",{className:"text-center",children:(0,a.jsx)("button",{type:"button",className:"btn-danger",onClick:()=>(function(e){let t=[...o];t.splice(e,1),u(t.length?t:[{desc:"",qty:1,price:0}])})(t),children:"âœ•"})})]},t))})]}),(0,a.jsx)("div",{className:"p-2",children:(0,a.jsx)("button",{type:"button",className:"btn-outline",onClick:function(){u([...o,{desc:"",qty:1,price:0}])},children:"+ Agregar l\xednea"})})]}),(0,a.jsx)("div",{className:"flex items-center justify-end gap-2",children:(0,a.jsx)("button",{type:"submit",className:"btn-primary",children:"Guardar presupuesto"})}),p&&(0,a.jsx)("p",{className:"text-sm text-muted",children:p})]}),(0,a.jsxs)("div",{className:"card p-4",children:[(0,a.jsx)("h2",{className:"text-lg font-medium mb-3",children:"\xdaltimos presupuestos"}),(0,a.jsxs)("ul",{className:"divide-y",children:[b.map(e=>(0,a.jsxs)("li",{className:"py-3 flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{className:"min-w-0",children:[(0,a.jsx)("p",{className:"font-medium truncate",children:e.clienteNombre}),(0,a.jsxs)("p",{className:"text-sm text-muted",children:["Estado:"," ",(0,a.jsx)("span",{className:"aprobado"===e.estado?"badge-success":"enviado"===e.estado?"badge-info":"badge-muted",children:e.estado})," \xb7 ","Total $",Number(e.total).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"flex flex-wrap gap-2 shrink-0",children:[(0,a.jsxs)("a",{className:"btn-outline",href:"/presupuestos/".concat(e.id),target:"_blank",children:[(0,a.jsx)(n,{size:16})," Imprimir"]}),(0,a.jsx)("button",{className:"btn-outline",onClick:()=>v(e,"contado"),children:"Facturar contado"}),(0,a.jsx)("button",{className:"btn-outline",onClick:()=>v(e,"cta_cte"),children:"Facturar cta cte"})]})]},e.id)),0===b.length&&(0,a.jsxs)("div",{className:"empty",children:[(0,a.jsx)("h3",{children:"Sin presupuestos a\xfan"}),(0,a.jsx)("p",{children:"Cre\xe1 el primero arriba y empez\xe1 a vender âœ¨"})]})]})]})]})}}},e=>{e.O(0,[9135,3965,7240,8441,1255,7358],()=>e(e.s=4741)),_N_E=e.O()}]);
