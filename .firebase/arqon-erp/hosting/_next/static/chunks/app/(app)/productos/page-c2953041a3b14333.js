(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7921],{1092:(e,t,s)=>{Promise.resolve().then(s.bind(s,1188))},1188:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>d});var l=s(5155),a=s(2115),r=s(5728),i=s(9708);function o(e){if(null==e)return NaN;let t=String(e).trim();if(!t)return NaN;let s=(t=t.replace(/\s+/g,"").replace(/[^\d.,-]/g,"")).includes("."),l=t.includes(",");if(s&&l){let e=t.lastIndexOf(".");if(t.lastIndexOf(",")>e)t=(t=t.replace(/\./g,"")).replace(/,/g,".");else{let e=(t=t.replace(/,/g,"")).lastIndexOf(".");t=t.slice(0,e).replace(/\./g,"")+"."+t.slice(e+1)}}else if(l){let e=t.split(",");t=2===e.length&&e[1].length<=3?e[0].replace(/\./g,"")+"."+e[1]:t.replace(/,/g,"")}else if(s){let e=t.lastIndexOf(".");t=t.slice(0,e).replace(/\./g,"")+"."+t.slice(e+1)}let a=Number(t=t.replace(/[^0-9.-]/g,""));return isNaN(a)?NaN:a}function c(e,t){if(!isFinite(e))return e;switch(t){case"nearest10":return 10*Math.round(e/10);case"ceil10":return 10*Math.ceil(e/10);case"floor10":return 10*Math.floor(e/10);default:return e}}function n(e){return null!=e&&isFinite(Number(e))?"$".concat(Number(e).toFixed(2)):"â€”"}function d(){let[e,t]=(0,a.useState)([]),[s,d]=(0,a.useState)(""),[u,p]=(0,a.useState)(null),[m,h]=(0,a.useState)(""),[x,g]=(0,a.useState)(""),[b,j]=(0,a.useState)(""),[f,N]=(0,a.useState)("producto"),[v,w]=(0,a.useState)("costo"),[C,S]=(0,a.useState)(""),[k,y]=(0,a.useState)(""),[_,M]=(0,a.useState)("0"),[I,E]=(0,a.useState)("nearest10"),O=(0,a.useMemo)(()=>k?k.split("+").map(e=>o(e)).filter(e=>isFinite(e)&&e>0):[],[k]),P=(0,a.useMemo)(()=>{let e=o(C),t=o(_)||0;if(!isFinite(e)||e<=0)return{costo_neto:null,precio:null};if("costo"!==v)return{costo_neto:null,precio:Math.round(100*c(e,I))/100};{let s=O.reduce((e,t)=>e*(1-t/100),e),l=c(s*(1+t/100),I);return{costo_neto:Math.round(100*s)/100,precio:Math.round(100*l)/100}}},[C,O,_,I,v]);(0,a.useEffect)(()=>{let e=(0,i.P)((0,i.rJ)(r.db,"productos"),(0,i.My)("updatedAt","desc"),(0,i.AB)(300)),s=(0,i.aQ)(e,e=>{t(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>s()},[]);let D=(0,a.useMemo)(()=>{let t=s.trim().toLowerCase();return t?e.filter(e=>(e.descripcion||"").toLowerCase().includes(t)||(e.codigo||"").toLowerCase().includes(t)||(e.categoria||"").toLowerCase().includes(t)):e},[e,s]);function B(){p(null),h(""),g(""),j(""),N("producto"),w("costo"),S(""),y(""),M("0"),E("nearest10")}async function F(e){e.preventDefault();let t=o(C),s=o(_)||0;if(!x.trim())return alert("Complet\xe1 la descripci\xf3n");if(!isFinite(t)||t<=0)return alert("Precio base inv\xe1lido");let l={codigo:m||null,descripcion:x.trim(),categoria:b||null,tipo:f,precio_base:t,costo_neto:P.costo_neto,bonifs:O,markup:s,roundMode:I,precio:P.precio,listaId:null,listaNombre:null,updatedAt:(0,i.O5)()};try{u?await (0,i.mZ)((0,i.H9)(r.db,"productos",u),l):m?await (0,i.BN)((0,i.H9)(r.db,"productos",m),l,{merge:!0}):await (0,i.gS)((0,i.rJ)(r.db,"productos"),l),B()}catch(e){alert(e.message)}}async function H(e){confirm("\xbfEliminar producto?")&&(await (0,i.kd)((0,i.H9)(r.db,"productos",e)),u===e&&B())}return(0,l.jsxs)("main",{children:[(0,l.jsx)("h1",{className:"text-xl font-semibold mb-4",children:"Productos / Servicios"}),(0,l.jsx)("form",{onSubmit:F,className:"bg-white rounded-xl shadow p-4 mb-6",children:(0,l.jsxs)("div",{className:"grid md:grid-cols-2 gap-4",children:[(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"C\xf3digo"}),(0,l.jsx)("input",{className:"border rounded-lg p-2 w-full",value:m,onChange:e=>h(e.target.value),placeholder:"Opcional, ej: PROD-001"}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Si complet\xe1s c\xf3digo, el ID ser\xe1 ese (\xfatil para actualizar)."})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Tipo"}),(0,l.jsxs)("select",{className:"border rounded-lg p-2 w-full",value:f,onChange:e=>N(e.target.value),children:[(0,l.jsx)("option",{value:"producto",children:"Producto"}),(0,l.jsx)("option",{value:"servicio",children:"Servicio"})]})]}),(0,l.jsxs)("div",{className:"md:col-span-2",children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Descripci\xf3n *"}),(0,l.jsx)("input",{className:"border rounded-lg p-2 w-full",value:x,onChange:e=>g(e.target.value),required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Categor\xeda"}),(0,l.jsx)("input",{className:"border rounded-lg p-2 w-full",value:b,onChange:e=>j(e.target.value),placeholder:"Opcional"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Interpretaci\xf3n del precio"}),(0,l.jsxs)("select",{className:"border rounded-lg p-2 w-full",value:v,onChange:e=>w(e.target.value),children:[(0,l.jsx)("option",{value:"costo",children:"Costo del proveedor"}),(0,l.jsx)("option",{value:"venta",children:"Precio de venta (final)"})]})]}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("label",{className:"block text-sm font-medium mb-1",children:["costo"===v?"Costo base":"Precio de venta (final)"," *"]}),(0,l.jsx)("input",{className:"border rounded-lg p-2 w-full",value:C,onChange:e=>S(e.target.value),placeholder:"Ej: 12.345,67",required:!0})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Bonificaci\xf3n (cadena o % \xfanico)"}),(0,l.jsx)("input",{className:"border rounded-lg p-2 w-full",value:k,onChange:e=>y(e.target.value),placeholder:"Ej: 20+10 o 15"}),(0,l.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Se aplica sobre el costo. Dej\xe1 vac\xedo si no corresponde."})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Markup global (%)"}),(0,l.jsx)("input",{className:"border rounded-lg p-2 w-full",value:_,onChange:e=>M(e.target.value),placeholder:"Ej: 18"})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Redondeo"}),(0,l.jsxs)("select",{className:"border rounded-lg p-2 w-full",value:I,onChange:e=>E(e.target.value),children:[(0,l.jsx)("option",{value:"none",children:"Sin redondeo"}),(0,l.jsx)("option",{value:"nearest10",children:"Al m\xfaltiplo de 10 m\xe1s cercano"}),(0,l.jsx)("option",{value:"ceil10",children:"Hacia arriba (m\xfaltiplo de 10)"}),(0,l.jsx)("option",{value:"floor10",children:"Hacia abajo (m\xfaltiplo de 10)"})]})]}),(0,l.jsxs)("div",{className:"md:col-span-2 grid sm:grid-cols-2 gap-3",children:[(0,l.jsxs)("div",{className:"bg-gray-50 rounded-lg p-3",children:[(0,l.jsxs)("div",{className:"text-sm",children:["Costo neto (post-bonif): ",(0,l.jsx)("b",{children:n(P.costo_neto)})]}),(0,l.jsxs)("div",{className:"text-sm",children:["Precio final (c/ redondeo): ",(0,l.jsx)("b",{children:n(P.precio)})]})]}),(0,l.jsxs)("div",{className:"flex items-end gap-2",children:[(0,l.jsx)("button",{type:"submit",className:"bg-black text-white rounded-lg px-4 py-2",children:u?"Guardar cambios":"Crear producto/servicio"}),u&&(0,l.jsx)("button",{type:"button",onClick:B,className:"border rounded-lg px-4 py-2",children:"Cancelar edici\xf3n"})]})]})]})}),(0,l.jsx)("div",{className:"bg-white rounded-xl shadow p-4 mb-3",children:(0,l.jsx)("input",{className:"border rounded-lg p-2 w-full",placeholder:"Buscar por descripci\xf3n, c\xf3digo o categor\xedaâ€¦",value:s,onChange:e=>d(e.target.value)})}),(0,l.jsx)("div",{className:"bg-white rounded-xl shadow p-4 overflow-x-auto",children:(0,l.jsxs)("table",{className:"min-w-full text-sm",children:[(0,l.jsx)("thead",{className:"bg-gray-100",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)("th",{className:"text-left p-2",children:"Descripci\xf3n"}),(0,l.jsx)("th",{className:"text-left p-2",children:"C\xf3digo"}),(0,l.jsx)("th",{className:"text-left p-2",children:"Categor\xeda"}),(0,l.jsx)("th",{className:"text-left p-2",children:"Tipo"}),(0,l.jsx)("th",{className:"text-right p-2",children:"Precio fuente"}),(0,l.jsx)("th",{className:"text-right p-2",children:"Bonif"}),(0,l.jsx)("th",{className:"text-right p-2",children:"Costo neto"}),(0,l.jsx)("th",{className:"text-right p-2",children:"Markup"}),(0,l.jsx)("th",{className:"text-right p-2",children:"Precio final"}),(0,l.jsx)("th",{className:"p-2"})]})}),(0,l.jsxs)("tbody",{children:[D.map(e=>(0,l.jsxs)("tr",{className:"border-t",children:[(0,l.jsx)("td",{className:"p-2",children:e.descripcion}),(0,l.jsx)("td",{className:"p-2",children:e.codigo||"â€”"}),(0,l.jsx)("td",{className:"p-2",children:e.categoria||"â€”"}),(0,l.jsx)("td",{className:"p-2",children:e.tipo||"â€”"}),(0,l.jsx)("td",{className:"p-2 text-right",children:n(e.precio_base)}),(0,l.jsx)("td",{className:"p-2 text-right",children:e.bonifs&&e.bonifs.length?e.bonifs.join("+")+"%":"â€”"}),(0,l.jsx)("td",{className:"p-2 text-right",children:n(e.costo_neto)}),(0,l.jsx)("td",{className:"p-2 text-right",children:"number"==typeof e.markup?"".concat(e.markup.toFixed(2),"%"):"â€”"}),(0,l.jsx)("td",{className:"p-2 text-right",children:n(e.precio)}),(0,l.jsx)("td",{className:"p-2 text-right",children:(0,l.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,l.jsx)("button",{className:"border rounded px-2 py-1",onClick:()=>{var t,s;p(e.id||null),h(e.codigo||""),g(e.descripcion||""),j(e.categoria||""),N(e.tipo||"producto"),w(null!==e.costo_neto&&void 0!==e.costo_neto?"costo":"venta"),S(String(null!=(t=e.precio_base)?t:"")),y(e.bonifs&&e.bonifs.length?e.bonifs.join("+"):""),M(String(null!=(s=e.markup)?s:"0")),E(e.roundMode||"nearest10"),window.scrollTo({top:0,behavior:"smooth"})},children:"Editar"}),(0,l.jsx)("button",{className:"text-red-600",onClick:()=>H(e.id),children:"Eliminar"})]})})]},e.id)),0===D.length&&(0,l.jsx)("tr",{children:(0,l.jsx)("td",{className:"p-4 text-center text-gray-500",colSpan:10,children:"Sin productos"})})]})]})})]})}},5728:(e,t,s)=>{"use strict";s.d(t,{j:()=>o,db:()=>c});var l=s(2078),a=s(2553),r=s(9708);let i=(0,l.Dk)().length?(0,l.Sx)():(0,l.Wp)({apiKey:"AIzaSyBn_tEKXbH1MODTU-ZX6wI7H6gcrIib0RM",authDomain:"arqon-erp.firebaseapp.com",projectId:"arqon-erp",storageBucket:"arqon-erp.appspot.com",messagingSenderId:"100563303537",appId:"1:100563303537:web:361ed1c0989e4868c16fd0"}),o=(0,a.xI)(i),c=(0,r.aU)(i)}},e=>{e.O(0,[9135,3965,7240,8441,1255,7358],()=>e(e.s=1092)),_N_E=e.O()}]);
