(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[415],{2409:(e,t,a)=>{Promise.resolve().then(a.bind(a,4514))},4514:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>n});var s=a(5155),r=a(2115);function l(e){if(null==e)return;let t=Number(String(e).replace(",",".").trim());return Number.isFinite(t)?t:void 0}function n(){let[e,t]=(0,r.useState)("BASE"),[n,i]=(0,r.useState)("Lista Base"),[c,o]=(0,r.useState)(!1),[d,u]=(0,r.useState)(25),[p,m]=(0,r.useState)(10),[x,h]=(0,r.useState)(!0),[b,g]=(0,r.useState)([]),[j,N]=(0,r.useState)(null),[v,f]=(0,r.useState)(!1),y=(0,r.useMemo)(()=>b.length,[b]);async function k(e){var t;N(null);let s=null==(t=e.target.files)?void 0:t[0];if(s)try{let e=await Promise.all([a.e(3524),a.e(8436)]).then(a.bind(a,4246)),t=await s.arrayBuffer(),r=e.read(t,{type:"array"}),n=r.Sheets[r.SheetNames[0]],i=e.utils.sheet_to_json(n,{defval:""}),c=Object.keys(i[0]||{}),o=e=>c.find(t=>e.includes((null!=t?t:"").toString().trim().toLowerCase())),d=o(["sku","codigo","c\xf3digo","code","articulo","art\xedculo"]),u=o(["costo","cost","costo unit","costo_unit","costounit"]),p=o(["precio","price","pvp","venta"]),m=i.map(e=>{var t;return{sku:d?String(null!=(t=e[d])?t:"").trim():"",costo:u?l(e[u]):void 0,precio:p?l(e[p]):void 0}}).filter(e=>e.sku);g(m)}catch(e){console.error(e),N((null==e?void 0:e.message)||"No se pudo leer el archivo")}}function S(e,t,a){let s=[...b];"costo"===t||"precio"===t?s[e][t]=l(a):s[e][t]=a,g(s)}async function C(){if(N(null),!b.length)return N("No hay filas para importar");f(!0);try{var t;let a={lista:{codigo:e,nombre:n,activo:!0},opciones:{usarPrecioArchivo:c,markupPct:Number(d)||0,redondeo:Number(p)||0,actualizarProductosBase:"BASE"===e.toUpperCase()&&!!x},upsert:!0,items:b},s=await fetch("/api/import/listas",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),r=await s.json();if(!r.ok)throw Error(r.error||"Error importando");N("✅ Importaci\xf3n OK \xb7 Lista ".concat(r.codigo," \xb7 Total: ").concat(r.total," \xb7 (Productos actualizados: ").concat(null!=(t=r.prodUpdated)?t:0,")"))}catch(e){N("❌ ".concat(e.message||"Error importando"))}finally{f(!1)}}return(0,s.jsxs)("main",{className:"space-y-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:"Importar listas de precios"}),(0,s.jsxs)("p",{className:"text-sm text-neutral-300",children:["Sub\xed un XLSX/CSV con columnas ",(0,s.jsx)("b",{children:"sku"}),", ",(0,s.jsx)("b",{children:"costo"})," y/o ",(0,s.jsx)("b",{children:"precio"}),". Si eleg\xeds “Usar precio del archivo”, se tomar\xe1n los valores de la columna ",(0,s.jsx)("b",{children:"precio"}),". Si no, se calcular\xe1 desde ",(0,s.jsx)("b",{children:"costo"})," con ",(0,s.jsx)("b",{children:"markup"})," y",(0,s.jsx)("b",{children:" redondeo"})," al m\xfaltiplo superior."]}),(0,s.jsxs)("div",{className:"rounded-lg border border-neutral-800 bg-neutral-900 p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs text-neutral-400 mb-1",children:"C\xf3digo de lista"}),(0,s.jsx)("input",{className:"w-full rounded-md bg-neutral-950 px-3 py-2 ring-1 ring-neutral-800",value:e,onChange:e=>t(e.target.value.toUpperCase()),placeholder:"BASE / MAYORISTA / ..."})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-xs text-neutral-400 mb-1",children:"Nombre"}),(0,s.jsx)("input",{className:"w-full rounded-md bg-neutral-950 px-3 py-2 ring-1 ring-neutral-800",value:n,onChange:e=>i(e.target.value)})]}),(0,s.jsxs)("div",{className:"flex items-end gap-2",children:[(0,s.jsx)("input",{id:"usarPrecio",type:"checkbox",className:"h-4 w-4",checked:c,onChange:e=>o(e.target.checked)}),(0,s.jsx)("label",{htmlFor:"usarPrecio",className:"text-sm",children:"Usar precio del archivo"})]}),(0,s.jsxs)("div",{className:"flex items-end gap-2",children:[(0,s.jsx)("input",{id:"actualizarBase",type:"checkbox",className:"h-4 w-4",checked:x,onChange:e=>h(e.target.checked),disabled:"BASE"!==e.toUpperCase()}),(0,s.jsxs)("label",{htmlFor:"actualizarBase",className:"text-sm",children:["Actualizar ",(0,s.jsx)("b",{children:"productos.precio"})," (s\xf3lo BASE)"]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs text-neutral-400 mb-1",children:"Markup %"}),(0,s.jsx)("input",{type:"number",step:"0.01",className:"w-full rounded-md bg-neutral-950 px-3 py-2 ring-1 ring-neutral-800",value:d,onChange:e=>u(Number(e.target.value)),disabled:c})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs text-neutral-400 mb-1",children:"Redondeo (m\xfaltiplo superior)"}),(0,s.jsx)("input",{type:"number",className:"w-full rounded-md bg-neutral-950 px-3 py-2 ring-1 ring-neutral-800",value:p,onChange:e=>m(Number(e.target.value)),disabled:c,placeholder:"10 / 100 / 5 ..."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-xs text-neutral-400 mb-1",children:"Archivo (XLSX/CSV)"}),(0,s.jsx)("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:k,className:"block w-full"})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{onClick:C,disabled:!b.length||v,className:"rounded-md bg-emerald-600 px-4 py-2 font-medium disabled:opacity-50",children:v?"Importando...":"Importar (".concat(y," \xedtems)")}),(0,s.jsx)("button",{onClick:function(){g(e=>[...e,{sku:"",costo:void 0,precio:void 0}])},className:"rounded-md border border-neutral-700 px-3 py-2",children:"+ Agregar fila"}),(0,s.jsx)("button",{onClick:function(){g([]),N(null)},className:"rounded-md border border-neutral-700 px-3 py-2",children:"Limpiar"}),j&&(0,s.jsx)("span",{className:"text-sm text-neutral-300",children:j})]})]}),!!b.length&&(0,s.jsx)("div",{className:"rounded-lg border border-neutral-800 overflow-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-neutral-900/60",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"p-2 text-left",children:"SKU"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"Costo"}),(0,s.jsx)("th",{className:"p-2 text-right",children:"Precio (archivo)"}),(0,s.jsx)("th",{className:"p-2"})]})}),(0,s.jsx)("tbody",{children:b.map((e,t)=>{var a,r;return(0,s.jsxs)("tr",{className:"border-t border-neutral-800",children:[(0,s.jsx)("td",{className:"p-2",children:(0,s.jsx)("input",{className:"w-48 rounded-md bg-neutral-950 px-2 py-1 ring-1 ring-neutral-800",value:e.sku,onChange:e=>S(t,"sku",e.target.value)})}),(0,s.jsx)("td",{className:"p-2 text-right",children:(0,s.jsx)("input",{type:"number",step:"0.01",className:"w-32 rounded-md bg-neutral-950 px-2 py-1 text-right ring-1 ring-neutral-800",value:null!=(a=e.costo)?a:"",onChange:e=>S(t,"costo",e.target.value),disabled:c})}),(0,s.jsx)("td",{className:"p-2 text-right",children:(0,s.jsx)("input",{type:"number",step:"0.01",className:"w-32 rounded-md bg-neutral-950 px-2 py-1 text-right ring-1 ring-neutral-800",value:null!=(r=e.precio)?r:"",onChange:e=>S(t,"precio",e.target.value),disabled:!c})}),(0,s.jsx)("td",{className:"p-2 text-center",children:(0,s.jsx)("button",{className:"text-red-400 hover:text-red-300",onClick:()=>(function(e){let t=[...b];t.splice(e,1),g(t)})(t),children:"✕"})})]},t)})})]})})]})}}},e=>{e.O(0,[8441,1255,7358],()=>e(e.s=2409)),_N_E=e.O()}]);